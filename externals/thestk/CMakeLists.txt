
set( RTMIDI_INSTALL_HEADER_BASE "include/${PROJECT_NAME}/externals" )

if( NATUS_LIBRARY_BUILD_SHARED )
set( BUILD_STATIC OFF  )
else()
set( BUILD_STATIC ON )
endif()
option( BUILD_SHARED_LIBS "" ${NATUS_LIBRARY_BUILD_SHARED} )
option( BUILD_STATIC_LIBS "" ${BUILD_STATIC} )
option( BUILD_TESTING "" OFF )


#cmake_policy( PUSH )
#set( CMAKE_POLICY_DEFAULT_CMP0042 OLD )
#cmake_policy( SET CMP0042 OLD )

add_subdirectory( rtmidi )
#cmake_policy( POP )
set( RTMIDI_TARGETNAME_UNINSTALL rtmidi_uninstall CACHE STRING "" FORCE )

if( TARGET rtmidi )
set_target_properties( rtmidi PROPERTIES FOLDER "natus/externals/rtmidi" )
else()
set_target_properties( rtmidi_static PROPERTIES FOLDER "natus/externals/rtmidi" )
endif()
if( TARGET rtmidi_uninstall )
set_target_properties( rtmidi_uninstall PROPERTIES FOLDER "natus/externals/rtmidi" )
endif()
set( RTMIDI_INCLUDE_DIRS "${CMAKE_CURRENT_LIST_DIR}/rtmidi" )

if( TARGET rtmidi )
target_compile_definitions( rtmidi PRIVATE RTMIDI_DO_NOT_ENSURE_UNIQUE_PORTNAMES )
else()
target_compile_definitions( rtmidi_static PRIVATE RTMIDI_DO_NOT_ENSURE_UNIQUE_PORTNAMES )
endif()

if( NATUS_COMPILER_MSC )
  if( TARGET rtmidi )
    target_compile_options( rtmidi PRIVATE /wd4251 /wd4267 /wd4275 /wd4996 )
  endif()
  if( TARGET rtmidi_static )
    target_compile_options( rtmidi_static PRIVATE /wd4251 /wd4267 /wd4275 /wd4996 )
  endif()
endif()

if( TARGET rtmidi )
target_include_directories( rtmidi PUBLIC $<BUILD_INTERFACE:${RTMIDI_INCLUDE_DIRS}> )
else()
target_include_directories( rtmidi_static PUBLIC $<BUILD_INTERFACE:${RTMIDI_INCLUDE_DIRS}> )
endif() 

add_library( rtmidi_trg INTERFACE )
if( NATUS_LIBRARY_BUILD_SHARED )
  target_link_libraries( rtmidi_trg INTERFACE rtmidi )
else()
  target_link_libraries( rtmidi_trg INTERFACE rtmidi_static )
endif()

if( TARGET rtmidi )
export( TARGETS rtmidi NAMESPACE natus:: APPEND FILE ${NATUS_BINARY_DIR}/natus-targets.cmake )
endif()

unset( JACK_LIB CACHE )
unset( PKG_CONFIG_EXECUTABLE CACHE )
unset( BUILD_SHARED_LIBS CACHE )
unset( BUILD_STATIC_LIBS CACHE )
unset( BUILD_TESTING CACHE )
unset( RTMIDI_API_CORE CACHE )
unset( RTMIDI_API_JACK CACHE )
unset( RTMIDI_API_WINMM CACHE )
